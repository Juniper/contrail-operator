apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 10-master-network-functions
spec:
  config:
    ignition:
      version: 2.2.0
    storage:
      files:
      - filesystem: root
        path: /etc/sysconfig/network-scripts/network-functions
        mode: 0744
        user:
          name: root
        contents:
          source: data:,%23%20-*-Shell-script-*-%0A%23%0A%23%20This%20file%20is%20not%20a%20stand-alone%20shell%20script%3B%20it%20provides%20functions%20%0A%23%20to%20network%20scripts%20that%20source%20it.%0A%0A%23%20Set%20up%20a%20default%20search%20path.%0APATH%3D%22%2Fsbin%3A%2Fusr%2Fsbin%3A%2Fbin%3A%2Fusr%2Fbin%22%0Aexport%20PATH%0A%0A%23%20We%20need%20to%20initialize%20the%20%24HOSTNAME%20variable%20by%20ourselves%20now%3A%0A%23%20(It%20was%20previously%20done%20for%20RHEL-6%20branch%2C%20but%20got%20lost%20in%20time.)%0AHOSTNAME%3D%22%24(hostname)%22%0A%0A%5B%20-z%20%22%24__sed_discard_ignored_files%22%20%5D%20%26%26%20.%20%2Fetc%2Finit.d%2Ffunctions%0A%0Aget_hwaddr%20()%0A%7B%0A%20%20%20%20if%20%5B%20-f%20%2Fsys%2Fclass%2Fnet%2F%24%7B1%7D%2Faddress%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20tr%20'%5Ba-z%5D'%20'%5BA-Z%5D'%20%3C%20%2Fsys%2Fclass%2Fnet%2F%24%7B1%7D%2Faddress%0A%20%20%20%20elif%20%5B%20-d%20%22%2Fsys%2Fclass%2Fnet%2F%24%7B1%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20LC_ALL%3D%20LANG%3D%20ip%20-o%20link%20show%20%24%7B1%7D%202%3E%2Fdev%2Fnull%20%7C%20%5C%0A%20%20%20%20%20%20%20%20%20%20%20%20awk%20'%7B%20print%20toupper(gensub(%2F.*link%5C%2F%5B%5E%20%5D*%20(%5B%5B%3Aalnum%3A%5D%3A%5D*).*%2F%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%5C%5C1%22%2C%201))%3B%20%7D'%0A%20%20%20%20fi%0A%7D%0A%0Aget_config_by_device%20()%0A%7B%0A%20%20%20%20LANG%3DC%20grep%20-l%20%22%5E%5B%5B%3Aspace%3A%5D%5D*DEVICE%3D%5B'%5C%22%5D%5C%3F%24%7B1%7D%5B'%5C%22%5D%5C%3F%5C(%5B%5B%3Aspace%3A%5D%23%5D%5C%7C%24%5C)%22%20%5C%0A%20%20%20%20%20%20%20%20%2Fetc%2Fsysconfig%2Fnetwork-scripts%2Fifcfg-*%20%5C%0A%20%20%20%20%20%20%20%20%7C%20LC_ALL%3DC%20sed%20-e%20%22%24__sed_discard_ignored_files%22%0A%7D%0A%0Aget_config_by_hwaddr%20()%0A%7B%0A%20%20%20%20LANG%3DC%20grep%20-il%20%22%5E%5B%5B%3Aspace%3A%5D%5D*HWADDR%3D%5B'%5C%22%5D%5C%3F%24%7B1%7D%5B'%5C%22%5D%5C%3F%5C(%5B%5B%3Aspace%3A%5D%23%5D%5C%7C%24%5C)%22%20%2Fetc%2Fsysconfig%2Fnetwork-scripts%2Fifcfg-*%20%5C%0A%20%20%20%20%20%20%20%20%7C%20LC_ALL%3DC%20sed%20-e%20%22%24__sed_discard_ignored_files%22%0A%7D%0A%0Aget_config_by_subchannel%20()%0A%7B%0A%20%20%20%20LANG%3DC%20grep%20-E%20-i%20-l%20%5C%0A%20%20%20%20%20%20%20%20%22%5E%5B%5B%3Aspace%3A%5D%5D*SUBCHANNELS%3D%5B'%5C%22%5D%3F(%5B0-9%5D%5C.%5B0-9%5D%5C.%5Ba-f0-9%5D%2B%2C)%7B0%2C2%7D%24%7B1%7D(%2C%5B0-9%5D%5C.%5B0-9%5D%5C.%5Ba-f0-9%5D%2B)%7B0%2C2%7D%5B'%5C%22%5D%3F(%5B%5B%3Aspace%3A%5D%5D%2B%23%7C%5B%5B%3Aspace%3A%5D%5D*%24)%22%20%5C%0A%20%20%20%20%20%20%20%20%2Fetc%2Fsysconfig%2Fnetwork-scripts%2Fifcfg-*%20%5C%0A%20%20%20%20%20%20%20%20%7C%20LC_ALL%3DC%20sed%20-e%20%22%24__sed_discard_ignored_files%22%0A%7D%0A%0Aget_config_by_name%20()%0A%7B%0A%20%20%20%20LANG%3DC%20grep%20-E%20-i%20-l%20%22%5E%5B%5B%3Aspace%3A%5D%5D*NAME%3D%5C%22(Auto%20%7CSystem%20)%3F%24%7B1%7D%5C%22%22%20%5C%0A%20%20%20%20%20%20%20%20%2Fetc%2Fsysconfig%2Fnetwork-scripts%2Fifcfg-*%20%5C%0A%20%20%20%20%20%20%20%20%7C%20LC_ALL%3DC%20sed%20-e%20%22%24__sed_discard_ignored_files%22%0A%7D%0A%0Aget_device_by_hwaddr%20()%0A%7B%0A%20%20%20%20LANG%3DC%20ip%20-o%20link%20%7C%20awk%20-F%20'%3A%20'%20-vIGNORECASE%3D1%20'!%2Flink%5C%2Fieee802%5C.11%2F%20%26%26%20%2F'%22%241%22'%2F%20%7B%20print%20%242%20%7D'%0A%7D%0A%0Aget_uuid_by_config%20()%0A%7B%0A%20%20%20%20dbus-send%20--system%20--print-reply%20--dest%3Dcom.redhat.ifcfgrh1%20%2Fcom%2Fredhat%2Fifcfgrh1%20com.redhat.ifcfgrh1.GetIfcfgDetails%20string%3A%22%2Fetc%2Fsysconfig%2Fnetwork-scripts%2F%241%22%202%3E%2Fdev%2Fnull%20%7C%20awk%20-F%20'%22'%20'%2Fstring%20%2F%20%7B%20print%20%242%20%7D'%0A%7D%0A%0Agenerate_lease_file_name%20()%0A%7B%0A%20%20%20%20local%20ver%3D%241%0A%20%20%20%20LEASEFILE%3D%22%2Fvar%2Flib%2Fdhclient%2Fdhclient%24ver-%24%7BDEVICE%7D.leases%22%0A%20%20%20%20if%20%5B%20-f%20%24LEASEFILE%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20return%0A%20%20%20%20fi%0A%20%20%20%20LEASEFILE%3D%22%2Fvar%2Flib%2Fdhclient%2Fdhclient%24ver-%24%7BUUID%7D-%24%7BDEVICE%7D.lease%22%0A%7D%0A%0Agenerate_config_file_name%20()%0A%7B%0A%20%20%20%20local%20ver%3D%241%0A%20%20%20%20if%20%5B%20-s%20%2Fetc%2Fdhcp%2Fdhclient%24ver-%24%7BDEVICE%7D.conf%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20DHCLIENTCONF%3D%22-cf%20%2Fetc%2Fdhcp%2Fdhclient%24ver-%24%7BDEVICE%7D.conf%22%3B%0A%20%20%20%20elif%20%5B%20-s%20%2Fetc%2Fdhclient%24ver-%24%7BDEVICE%7D.conf%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20DHCLIENTCONF%3D%22-cf%20%2Fetc%2Fdhclient%24ver-%24%7BDEVICE%7D.conf%22%3B%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20DHCLIENTCONF%3D''%3B%0A%20%20%20%20fi%0A%7D%0A%0Aneed_config%20()%0A%7B%0A%20%20%20%20local%20nconfig%0A%0A%20%20%20%20CONFIG%3D%22ifcfg-%24%7B1%7D%22%0A%20%20%20%20%5B%20-f%20%22%24%7BCONFIG%7D%22%20%5D%20%26%26%20return%0A%20%20%20%20CONFIG%3D%22%24%7B1%23%23*%2F%7D%22%0A%20%20%20%20%5B%20-f%20%22%24%7BCONFIG%7D%22%20%5D%20%26%26%20return%0A%20%20%20%20nconfig%3D%24(get_config_by_name%20%22%24%7B1%7D%22)%0A%20%20%20%20if%20%5B%20-n%20%22%24nconfig%22%20%5D%20%26%26%20%5B%20-f%20%22%24nconfig%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20CONFIG%3D%24%7Bnconfig%23%23*%2F%7D%0A%20%20%20%20%20%20%20%20return%0A%20%20%20%20fi%0A%20%20%20%20local%20addr%3D%24(get_hwaddr%20%24%7B1%7D)%0A%20%20%20%20if%20%5B%20-n%20%22%24addr%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20nconfig%3D%24(get_config_by_hwaddr%20%24%7Baddr%7D)%0A%20%20%20%20%20%20%20%20if%20%5B%20-n%20%22%24nconfig%22%20%5D%20%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20CONFIG%3D%24%7Bnconfig%23%23*%2F%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%5B%20-f%20%22%24%7BCONFIG%7D%22%20%5D%20%26%26%20return%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%20%20%20%20nconfig%3D%24(get_config_by_device%20%24%7B1%7D)%0A%20%20%20%20if%20%5B%20-n%20%22%24nconfig%22%20%5D%20%26%26%20%5B%20-f%20%22%24nconfig%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20CONFIG%3D%24%7Bnconfig%23%23*%2F%7D%0A%20%20%20%20%20%20%20%20return%0A%20%20%20%20fi%0A%7D%0A%0Asource_config%20()%0A%7B%0A%20%20%20%20CONFIG%3D%24%7BCONFIG%23%23*%2F%7D%0A%20%20%20%20DEVNAME%3D%24%7BCONFIG%23%23ifcfg-%7D%0A%20%20%20%20.%20%2Fetc%2Fsysconfig%2Fnetwork-scripts%2F%24CONFIG%0A%20%20%20%20%5B%20-r%20%22keys-%24DEVNAME%22%20%5D%20%26%26%20.%20%2Fetc%2Fsysconfig%2Fnetwork-scripts%2Fkeys-%24DEVNAME%0A%20%20%20%20case%20%22%24TYPE%22%20in%0A%20%20%20%20Ethernet)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22eth%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20CIPE)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22cipcb%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20IPSEC)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22ipsec%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20Modem)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22ppp%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20xDSL)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22ppp%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20ISDN)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22ippp%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20Wireless)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22eth%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20%22Token%20Ring%22)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22eth%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20CTC)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22ctc%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20GRE%20%7C%20IPIP%20%7C%20IPIP6)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22tunnel%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20SIT%20%7C%20sit)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22sit%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20InfiniBand%20%7C%20infiniband)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22ib%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20OVS*)%0A%20%20%20%20%20%20%20%20DEVICETYPE%3D%22ovs%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20esac%0A%20%20%20%20if%20%5B%20-n%20%22%24HWADDR%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20HWADDR%3D%24(tr%20'%5Ba-z%5D'%20'%5BA-Z%5D'%20%3C%3C%3C%22%24HWADDR%22)%0A%20%20%20%20fi%0A%20%20%20%20if%20%5B%20-n%20%22%24MACADDR%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20MACADDR%3D%24(tr%20'%5Ba-z%5D'%20'%5BA-Z%5D'%20%3C%3C%3C%22%24MACADDR%22)%0A%20%20%20%20fi%0A%20%20%20%20%5B%20-z%20%22%24DEVICE%22%20-a%20-n%20%22%24HWADDR%22%20%5D%20%26%26%20DEVICE%3D%24(get_device_by_hwaddr%20%24HWADDR)%0A%20%20%20%20%5B%20-z%20%22%24DEVICETYPE%22%20%5D%20%26%26%20DEVICETYPE%3D%24(echo%20%24%7BDEVICE%7D%20%7C%20sed%20%22s%2F%5B0-9%5D*%24%2F%2F%22)%0A%20%20%20%20%5B%20-z%20%22%24REALDEVICE%22%20-a%20-n%20%22%24PARENTDEVICE%22%20%5D%20%26%26%20REALDEVICE%3D%24PARENTDEVICE%0A%20%20%20%20%5B%20-z%20%22%24REALDEVICE%22%20%5D%20%26%26%20REALDEVICE%3D%24%7BDEVICE%25%25%3A*%7D%0A%20%20%20%20%5B%20-z%20%22%24SYSCTLDEVICE%22%20%5D%20%26%26%20SYSCTLDEVICE%3D%24%7BREALDEVICE%2F.%2F%2F%7D%0A%20%20%20%20if%20%5B%20%22%24%7BDEVICE%7D%22%20!%3D%20%22%24%7BREALDEVICE%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20ISALIAS%3Dyes%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20ISALIAS%3Dno%0A%20%20%20%20fi%0A%20%20%20%20if%20is_nm_running%20%26%26%20%5B%20%22%24REALDEVICE%22%20!%3D%20%22lo%22%20%5D%20%3B%20then%0A%20%20%20%20%20%20%20%20nm_con_load%20%22%24CONFIG%22%0A%20%20%20%20%20%20%20%20if%20!%20is_false%20%24NM_CONTROLLED%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20UUID%3D%24(get_uuid_by_config%20%24CONFIG)%0A%20%20%20%20%20%20%20%20%20%20%20%20%5B%20-n%20%22%24UUID%22%20%5D%20%26%26%20_use_nm%3Dtrue%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%7D%0A%0Anm_con_load%20()%20%7B%0A%20%20%20%20dbus-send%20--system%20--print-reply%20%5C%0A%20%20%20%20%20%20%20%20--dest%3Dorg.freedesktop.NetworkManager%20%5C%0A%20%20%20%20%20%20%20%20%2Forg%2Ffreedesktop%2FNetworkManager%2FSettings%20%5C%0A%20%20%20%20%20%20%20%20org.freedesktop.NetworkManager.Settings.LoadConnections%20%5C%0A%20%20%20%20%20%20%20%20array%3Astring%3A%22%2Fetc%2Fsysconfig%2Fnetwork-scripts%2F%24%7B1%7D%22%20%3E%2Fdev%2Fnull%202%3E%261%0A%7D%0A%0Aethtool_set()%0A%7B%0A%20%20%20%20oldifs%3D%24IFS%3B%0A%20%20%20%20IFS%3D'%3B'%3B%0A%20%20%20%20if%20%5B%20-n%20%22%24%7BETHTOOL_DELAY%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%23%20Convert%20microseconds%20to%20seconds%3A%0A%20%20%20%20%20%20local%20ETHTOOL_DELAY_SEC%3D%24(convert2sec%20%24%7BETHTOOL_DELAY%7D%20micro)%0A%20%20%20%20%20%20sleep%20%24%7BETHTOOL_DELAY_SEC%7D%0A%20%20%20%20fi%0A%20%20%20%20for%20opts%20in%20%24ETHTOOL_OPTS%20%3B%20do%0A%20%20%20%20%20%20%20%20IFS%3D%24oldifs%3B%0A%20%20%20%20%20%20%20%20if%20%5B%5B%20%22%24%7Bopts%7D%22%20%3D~%20%5B%5B%3Aspace%3A%5D%5D*-%20%5D%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Fsbin%2Fethtool%20%24opts%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Fsbin%2Fethtool%20-s%20%24%7BREALDEVICE%7D%20%24opts%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20IFS%3D'%3B'%3B%0A%20%20%20%20done%0A%20%20%20%20IFS%3D%24oldifs%3B%0A%7D%0A%0Aexpand_config%20()%0A%7B%0A%20%20%20%20local%20i%3D0%20val%0A%20%20%20%20for%20idx%20in%20''%20%7B0..255%7D%20%3B%20do%0A%20%20%20%20%20%20%20%20ipaddr%5B%24i%5D%3D%24(eval%20echo%20'%24'IPADDR%24idx)%0A%20%20%20%20%20%20%20%20if%20%5B%20-z%20%22%24%7Bipaddr%5B%24i%5D%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%5B%20%22%24idx%22%20%5D%20%26%26%20%5B%20%24idx%20-ge%202%20%5D%20%26%26%20break%0A%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20prefix%5B%24i%5D%3D%24(eval%20echo%20'%24'PREFIX%24idx)%0A%20%20%20%20%20%20%20%20netmask%5B%24i%5D%3D%24(eval%20echo%20'%24'NETMASK%24idx)%0A%20%20%20%20%20%20%20%20broadcast%5B%24i%5D%3D%24(eval%20echo%20'%24'BROADCAST%24idx)%0A%20%20%20%20%20%20%20%20arpcheck%5B%24i%5D%3D%24(eval%20echo%20'%24'ARPCHECK%24idx)%0A%20%20%20%20%20%20%20%20arpupdate%5B%24i%5D%3D%24(eval%20echo%20'%24'ARPUPDATE%24idx)%0A%0A%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Bprefix%5B%24i%5D%7Dx%22%20!%3D%20%22x%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20val%3D%24(%2Fbin%2Fipcalc%20--netmask%20%22%24%7Bipaddr%5B%24i%5D%7D%2F%24%7Bprefix%5B%24i%5D%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20netmask%5B%24i%5D%3D%24%7Bval%23%23NETMASK%3D%7D%0A%20%20%20%20%20%20%20%20fi%0A%0A%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Bnetmask%5B%24i%5D%7Dx%22%20%3D%20%22x%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20val%3D%24(%2Fbin%2Fipcalc%20--netmask%20%22%24%7Bipaddr%5B%24i%5D%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20netmask%5B%24i%5D%3D%24%7Bval%23%23NETMASK%3D%7D%0A%20%20%20%20%20%20%20%20fi%0A%0A%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Bprefix%5B%24i%5D%7Dx%22%20%3D%20%22x%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20val%3D%24(%2Fbin%2Fipcalc%20--prefix%20%24%7Bipaddr%5B%24i%5D%7D%20%24%7Bnetmask%5B%24i%5D%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20prefix%5B%24i%5D%3D%24%7Bval%23%23PREFIX%3D%7D%0A%20%20%20%20%20%20%20%20fi%0A%0A%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Bbroadcast%5B%24i%5D%7Dx%22%20%3D%20%22x%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20val%3D%24(%2Fbin%2Fipcalc%20--broadcast%20%24%7Bipaddr%5B%24i%5D%7D%20%24%7Bnetmask%5B%24i%5D%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20broadcast%5B%24i%5D%3D%24%7Bval%23%23BROADCAST%3D%7D%0A%20%20%20%20%20%20%20%20fi%0A%0A%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Barpcheck%5B%24i%5D%7Dx%22%20!%3D%20%22x%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20arpcheck%5B%24i%5D%3D%24%7Barpcheck%5B%24i%5D%23%23ARPCHECK%3D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20arpcheck%5B%24i%5D%3D%24%7Barpcheck%5B%24i%5D%2C%2C*%7D%0A%20%20%20%20%20%20%20%20fi%0A%0A%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Barpupdate%5B%24i%5D%7Dx%22%20!%3D%20%22x%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20arpupdate%5B%24i%5D%3D%24%7Barpupdate%5B%24i%5D%23%23ARPUPDATE%3D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20arpupdate%5B%24i%5D%3D%24%7Barpupdate%5B%24i%5D%2C%2C*%7D%0A%20%20%20%20%20%20%20%20fi%0A%0A%20%20%20%20%20%20%20%20i%3D%24((i%2B1))%0A%20%20%20%20done%0A%0A%20%20%20%20%5B%20-n%20%22%24DHCP_HOSTNAME%22%20%5D%20%26%26%20DHCP_HOSTNAME%3D%24%7BDHCP_HOSTNAME%25%25.*%7D%0A%0A%20%20%20%20if%20%5B%20-z%20%22%24%7BNETWORK%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20eval%20%24(%2Fbin%2Fipcalc%20--network%20%24%7Bipaddr%5B0%5D%7D%20%24%7Bnetmask%5B0%5D%7D)%0A%20%20%20%20fi%0A%7D%0A%0Atoggle_value%20()%0A%7B%0A%20%20%20%20if%20%5B%20%22%242%22%20%3D%20%22yes%22%20%20%20%20-o%20%22%242%22%20%3D%20%22YES%22%20%5D%20%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22%241%20on%22%0A%20%20%20%20elif%20%5B%20%22%242%22%20%3D%20%22no%22%20%20%20%20-o%20%22%242%22%20%3D%20%22NO%22%20%5D%20%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22%241%20off%22%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20echo%20''%0A%20%20%20%20fi%0A%7D%0A%20%0Ado_netreport%20()%0A%7B%0A%20%20%20%20%23%20Notify%20programs%20that%20have%20requested%20notification%0A%20%20%20%20(%0A%20%20%20%20%20%20%20%20cd%20%2Fvar%2Frun%2Fnetreport%20%7C%7C%20exit%0A%20%20%20%20%20%20%20%20for%20i%20in%20*%20%3B%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20-f%20%24i%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20%22%24(id%20-u)%22%20%3D%20%220%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20OWNER%3D%24(stat%20-c%20%25U%20%24i)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20su%20-s%20%2Fbin%2Fbash%20%24OWNER%20-c%20%22kill%20-SIGIO%20%24i%20%3E%2Fdev%2Fnull%202%3E%261%20%7C%7C%20rm%20-f%20%24i%20%3E%2Fdev%2Fnull%202%3E%261%22%20%3E%20%2Fdev%2Fnull%202%3E%261%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kill%20-SIGIO%20%24i%20%3E%2Fdev%2Fnull%202%3E%261%20%7C%7C%20rm%20-f%20%24i%20%3E%2Fdev%2Fnull%202%3E%261%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20done%0A%20%20%20%20)%0A%7D%0A%0Ais_nm_running%20()%0A%7B%0A%20%20%20%20dbus-send%20--system%20--print-reply%20%5C%0A%20%20%20%20%20%20%20%20--dest%3Dorg.freedesktop.DBus%20%5C%0A%20%20%20%20%20%20%20%20%2Forg%2Ffreedesktop%2FDBus%20%5C%0A%20%20%20%20%20%20%20%20org.freedesktop.DBus.GetNameOwner%20%5C%0A%20%20%20%20%20%20%20%20string%3A%22org.freedesktop.NetworkManager%22%20%3E%2Fdev%2Fnull%202%3E%261%0A%7D%0A%0Ais_nm_active%20()%0A%7B%0A%20%20%20%20LANG%3DC%20nmcli%20-t%20--fields%20device%2Cstate%20dev%20status%202%3E%2Fdev%2Fnull%20%7C%20grep%20-q%20%22%5E%24%7B1%7D%3Aconnected%24%22%0A%7D%0A%0Ais_nm_handling%20()%0A%7B%0A%20%20%20%20LANG%3DC%20nmcli%20-t%20--fields%20device%2Cstate%20dev%20status%202%3E%2Fdev%2Fnull%20%7C%20grep%20-q%20%22%5E%5C(%24%7B1%7D%3Aconnected%5C)%5C%7C%5C(%24%7B1%7D%3Aconnecting.*%5C)%24%22%0A%7D%0A%0Ais_nm_device_unmanaged%20()%0A%7B%0A%20%20%20%20LANG%3DC%20nmcli%20-t%20--fields%20GENERAL%20dev%20show%20%22%24%7B1%7D%22%202%3E%2Fdev%2Fnull%20%7C%20awk%20-F%20'%3A'%20'%2FGENERAL.STATE%2F%20%7B%20if%20(%242%20%3D%3D%20%22unmanaged%22)%20exit%200%20%3B%20else%20exit%201%3B%20%7D'%0A%7D%0A%0A%23%20Sets%20%24alias%20to%20the%20device%20module%20if%20%24%3F%20!%3D%200%0Ais_available%20()%0A%7B%0A%20%20%20%20%5B%20-z%20%22%241%22%20%5D%20%26%26%20return%201%0A%0A%20%20%20%20%5B%20-d%20%22%2Fsys%2Fclass%2Fnet%2F%241%22%20%5D%20%26%26%20return%200%0A%0A%20%20%20%20%5B%20-n%20%22%24BONDING_OPTS%22%20%5D%20%26%26%20install_bonding_driver%20%241%0A%0A%20%20%20%20alias%3D%24(modprobe%20-c%20%7C%20awk%20%5C%0A%20%20%20%20%20%20%20%20'BEGIN%20%7B%20alias%20%3D%20%22%22%3B%20%7D%0A%20%20%20%20%20%20%20%20%241%20%3D%3D%20%22alias%22%20%26%26%20%242%20%3D%3D%20%22'%22%241%22'%22%20%7B%20alias%20%3D%20%243%3B%20%7D%0A%20%20%20%20%20%20%20%20%241%20%3D%3D%20%22install%22%20%7B%20install%5B%242%5D%20%3D%20%243%3B%20%7D%0A%20%20%20%20%20%20%20%20END%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20cmd%20%3D%20install%5Balias%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20print%20alias%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(alias%20%3D%3D%20%22%22%20%7C%7C%20alias%20%3D%3D%20%22off%22%20%7C%7C%20cmd%20%3D%3D%20%22%2Fbin%2Ftrue%22%20%7C%7C%20cmd%20%3D%3D%20%22%3A%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20exit%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20exit%200%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20')%0A%20%20%20%20%5B%20%24%3F%20-eq%200%20%5D%20%7C%7C%20return%202%0A%0A%20%20%20%20modprobe%20%241%20%3E%20%2Fdev%2Fnull%202%3E%261%20%7C%7C%20%7B%0A%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20%7D%0A%20%20%20%20if%20%5B%20-n%20%22%24HWADDR%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20local%20curdev%3D%24(get_device_by_hwaddr%20%22%24HWADDR%22)%0A%20%20%20%20%20%20%20%20if%20%5B%20-z%20%22%24curdev%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%0A%20%20%20%20if%20%5B%20%24%7Balias%7D%20%3D%20%22bonding%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20install_bonding_driver%20%241%0A%20%20%20%20fi%0A%0A%20%20%20%20%5B%20-d%20%22%2Fsys%2Fclass%2Fnet%2F%241%22%20%5D%20%26%26%20return%200%20%7C%7C%20return%201%0A%7D%0A%0Ais_available_wait%20()%0A%7B%0A%20%20%20%20%5B%20-z%20%22%241%22%20%5D%20%26%26%20return%201%0A%0A%20%20%20%20local%20retry%3D%24%7B2%23%23*%5B!0-9%5D*%7D%0A%0A%20%20%20%20is_available%20%241%20%26%26%20return%200%0A%20%20%20%20ret%3D%24%3F%0A%0A%20%20%20%20while%20%5B%200%22%24retry%22%20-gt%200%20%5D%3B%20do%0A%20%20%20%20%20%20%20%20sleep%201%0A%20%20%20%20%20%20%20%20%5B%20-d%20%22%2Fsys%2Fclass%2Fnet%2F%241%22%20%5D%20%26%26%20return%200%0A%20%20%20%20%20%20%20%20retry%3D%24((%24retry%20-1))%0A%20%20%20%20done%0A%0A%20%20%20%20return%20%24ret%0A%7D%0A%0Ais_hostname_set%20()%0A%7B%0A%20%20%20%20case%20%22%24%7BHOSTNAME%7D%22%20in%0A%20%20%20%20%20%20%20%20'(none)'%20%7C%20'localhost'%20%7C%20'localhost.localdomain')%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Hostname%20NOT%20set%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20%20%20%20%20*)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Hostname%20IS%20set%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%200%0A%20%20%20%20%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20esac%0A%7D%0A%0Aneed_hostname%20()%0A%7B%0A%20%20%20%20%23%20Should%20we%20avoid%20obtaining%20hostname%20from%20DHCP%3F%20(user%20override)%0A%20%20%20%20is_true%20%22%24%7BNO_DHCP_HOSTNAME%7D%22%20%26%26%20return%201%0A%0A%20%20%20%20if%20is_hostname_set%3B%20then%0A%20%20%20%20%20%20%20%20%23%20Hostname%20is%20already%20set%2C%20we%20do%20not%20need%20to%20acquire%20it%3A%0A%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20%23%20Hostname%20is%20NOT%20set%2C%20we%20need%20to%20acquire%20it%3A%0A%20%20%20%20%20%20%20%20return%200%0A%20%20%20%20fi%0A%7D%0A%0Aset_hostname_options%20()%0A%7B%0A%20%20%20%20%23%20User%20explicitly%20requires%20to%20*not*%20send%20DHCP_HOSTNAME%2C%20DHCP_FQDN%20or%20HOSTNAME%3A%0A%20%20%20%20is_false%20%22%24%7BDHCP_SEND_HOSTNAME%7D%22%20%26%26%20return%0A%0A%20%20%20%20if%20%5B%5B%20-n%20%22%24%7BDHCP_HOSTNAME%7D%22%20%26%26%20-n%20%22%24%7BDHCP_FQDN%7D%22%20%5D%5D%3B%20then%0A%20%20%20%20%20%20%20%20net_log%20%24%22Both%20'DHCP_HOSTNAME%3D%24%7BDHCP_HOSTNAME%7D'%20and%20'DHCP_FQDN%3D%24%7BDHCP_FQDN%7D'%20are%20configured...%20Using%20DHCP_FQDN.%22%20warning%0A%20%20%20%20fi%0A%0A%20%20%20%20local%20hostname_options%3D''%0A%0A%20%20%20%20%23%20DHCP_FQDN%20takes%20precedence%20before%20DHCP_HOSTNAME%20--%20as%20it%20does%20in%20NetworkManager%2C%0A%20%20%20%20%23%20and%20DHCP_HOSTNAME%20takes%20precedence%20before%20HOSTNAME%3A%0A%20%20%20%20if%20%5B%5B%20-n%20%22%24%7BDHCP_FQDN%7D%22%20%5D%5D%3B%20then%0A%20%20%20%20%20%20%20%20hostname_options%3D%22-F%20%24%7BDHCP_FQDN%7D%22%0A%20%20%20%20elif%20%5B%5B%20-n%20%22%24%7BDHCP_HOSTNAME%7D%22%20%5D%5D%3B%20then%0A%20%20%20%20%20%20%20%20hostname_options%3D%22-H%20%24%7BDHCP_HOSTNAME%7D%22%0A%20%20%20%20elif%20is_hostname_set%3B%20then%0A%20%20%20%20%20%20%20%20%23%20We%20need%20to%20truncate%20the%20hostname%20in%20case%20it%20is%20the%20FQDN%3A%0A%20%20%20%20%20%20%20%20hostname_options%3D%22-H%20%24%7BHOSTNAME%25%25.*%7D%22%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20%23%20Nothing%20to%20send%20to%20the%20DHCP%20server%3A%0A%20%20%20%20%20%20%20%20%23%20%5B'(none)'%2C%20'localhost'%20or%20'localhost.localdomain'%20are%20not%20valid%5D%0A%20%20%20%20%20%20%20%20return%0A%20%20%20%20fi%0A%0A%20%20%20%20%23%20Append%20the%20hostname%20options%20to%20the%20content%20of%20passed%20variable%20name%3A%0A%20%20%20%20eval%20%22%241%3D'%24%7B!1%7D%20%24%7Bhostname_options%7D'%22%0A%0A%20%20%20%20return%0A%7D%0A%0Aset_hostname%20()%0A%7B%0A%20%20%20%20hostname%20%241%0A%20%20%20%20if%20!%20grep%20search%20%2Fetc%2Fresolv.conf%20%3E%2Fdev%2Fnull%202%3E%261%3B%20then%0A%20%20%20%20%20%20%20%20domain%3D%24(echo%20%241%20%7C%20sed%20's%2F%5E%5B%5E%5C.%5D*%5C.%2F%2F')%0A%20%20%20%20%20%20%20%20if%20%5B%20-n%20%22%24domain%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20rsctmp%3D%24(mktemp%20%2Ftmp%2FXXXXXX)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20cat%20%2Fetc%2Fresolv.conf%20%3E%20%24rsctmp%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22search%20%24domain%22%20%3E%3E%20%24rsctmp%0A%20%20%20%20%20%20%20%20%20%20%20%20change_resolv_conf%20%24rsctmp%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Fbin%2Frm%20-f%20%24rsctmp%0A%20%20%20%20%20%20%20%20fi%20%20%20%20%0A%20%20%20%20fi%0A%7D%0A%0Acheck_device_down%20()%0A%7B%0A%20%20%20%20%5B%20!%20-d%20%2Fsys%2Fclass%2Fnet%2F%241%20%5D%20%26%26%20return%200%0A%20%20%20%20if%20LC_ALL%3DC%20ip%20-o%20link%20show%20dev%20%241%202%3E%2Fdev%2Fnull%20%7C%20grep%20-q%20%22%2CUP%22%20%3B%20then%0A%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20return%200%0A%20%20%20%20fi%0A%7D%0A%0Acheck_link_down%20()%0A%7B%0A%20%20%20%20if%20!%20LC_ALL%3DC%20ip%20link%20show%20dev%20%241%202%3E%2Fdev%2Fnull%7C%20grep%20-q%20%22%2CUP%22%20%3B%20then%0A%20%20%20%20%20%20%20%20ip%20link%20set%20dev%20%241%20up%20%3E%2Fdev%2Fnull%202%3E%261%0A%20%20%20%20fi%0A%20%20%20%20timeout%3D0%0A%20%20%20%20delay%3D10%0A%20%20%20%20%5B%20-n%20%22%24LINKDELAY%22%20%5D%20%26%26%20delay%3D%24((%24LINKDELAY%20*%202))%0A%20%20%20%20while%20%5B%20%24timeout%20-le%20%24delay%20%5D%3B%20do%0A%20%20%20%20%20%20%20%20%5B%20%22%24(cat%20%2Fsys%2Fclass%2Fnet%2F%24REALDEVICE%2Fcarrier%202%3E%2Fdev%2Fnull)%22%20!%3D%20%220%22%20%5D%20%26%26%20return%201%0A%20%20%20%20%20%20%20%20sleep%200.5%0A%20%20%20%20%20%20%20%20timeout%3D%24((timeout%2B1))%0A%20%20%20%20done%0A%20%20%20%20return%200%0A%7D%0A%0Acheck_default_route%20()%0A%7B%0A%20%20%20%20LC_ALL%3DC%20ip%20route%20list%20match%200.0.0.0%2F0%20%7C%20grep%20-q%20default%0A%7D%0A%0Afind_gateway_dev%20()%0A%7B%0A%20%20%20%20.%20%2Fetc%2Fsysconfig%2Fnetwork%0A%20%20%20%20if%20%5B%20-n%20%22%24%7BGATEWAY%7D%22%20-a%20%22%24%7BGATEWAY%7D%22%20!%3D%20%22none%22%20%5D%20%3B%20then%0A%20%20%20%20%20%20%20%20dev%3D%24(LC_ALL%3DC%20%2Fsbin%2Fip%20route%20get%20to%20%22%24%7BGATEWAY%7D%22%202%3E%2Fdev%2Fnull%20%7C%20%5C%0A%20%20%20%20%20%20%20%20sed%20-n%20's%2F.*%20dev%20%5C(%5B%5B%3Aalnum%3A%5D%5D*%5C)%20.*%2F%5C1%2Fp')%0A%20%20%20%20%20%20%20%20if%20%5B%20-n%20%22%24dev%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20GATEWAYDEV%3D%22%24dev%22%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%7D%0A%0A%23%20After%20the%20device%20%241%20goes%20away%2C%20restore%20the%20standard%20default%20route%3B%20typically%0A%23%20used%20for%20ppp%20with%20DEFROUTE%20temporarily%20replacing%20the%20%22standard%22%20default%0A%23%20route.%0A%23%20FIXME%3A%20This%20function%20doesn't%20support%20some%20newer%20features%20(GATEWAY%20in%20ifcfg%2C%0A%23%20%24WINDOW%2C%20%24METRIC)%0Aadd_default_route%20()%0A%7B%0A%20%20%20%20.%20%2Fetc%2Fsysconfig%2Fnetwork%0A%20%20%20%20check_default_route%20%26%26%20return%200%0A%20%20%20%20find_gateway_dev%0A%20%20%20%20if%20%5B%20%22%24GATEWAYDEV%22%20!%3D%20%22%22%20-a%20-n%20%22%24%7BGATEWAY%7D%22%20-a%20%5C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%22%24%7BGATEWAY%7D%22%20!%3D%20%22none%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20if%20!%20check_device_down%20%241%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20%22%24GATEWAY%22%20%3D%20%220.0.0.0%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Fsbin%2Fip%20route%20add%20default%20dev%20%24%7BGATEWAYDEV%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2Fsbin%2Fip%20route%20add%20default%20via%20%24%7BGATEWAY%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20elif%20%5B%20-f%20%2Fetc%2Fdefault-routes%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20while%20read%20spec%3B%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Fsbin%2Fip%20route%20add%20%24spec%0A%20%20%20%20%20%20%20%20done%20%3C%20%2Fetc%2Fdefault-routes%0A%20%20%20%20%20%20%20%20rm%20-f%20%2Fetc%2Fdefault-routes%0A%20%20%20%20fi%0A%7D%0A%0Ais_wireless_device%20()%0A%7B%0A%20%20%20%20%5B%20-x%20%2Fusr%2Fsbin%2Fiw%20%5D%20%7C%7C%20return%201%0A%20%20%20%20LC_ALL%3DC%20%2Fusr%2Fsbin%2Fiw%20dev%20%241%20info%20%3E%20%2Fdev%2Fnull%202%3E%261%20%26%26%20return%200%0A%20%20%20%20return%201%0A%7D%0A%0Aphy_wireless_device%20()%0A%7B%0A%20%20%20%20cat%20%2Fsys%2Fclass%2Fnet%2F%241%2Fphy80211%2Fname%0A%7D%0A%0Abond_master_exists%20()%0A%7B%0A%20%20%20%20local%20bond_name%0A%20%20%20%20%5B%20-z%20%22%24%7B1%7D%22%20%5D%20%26%26%20return%201%0A%20%20%20%20%5B%20!%20-f%20%2Fsys%2Fclass%2Fnet%2Fbonding_masters%20%5D%20%26%26%20return%201%0A%0A%20%20%20%20for%20bond_name%20in%20%24(%3C%20%2Fsys%2Fclass%2Fnet%2Fbonding_masters)%3B%20do%0A%20%20%20%20%20%20%20%20%5B%20%22%24%7Bbond_name%7D%22%20%3D%3D%20%22%24%7B1%7D%22%20%5D%20%26%26%20return%200%0A%20%20%20%20done%0A%20%20%20%20return%201%0A%7D%0A%0Ainstall_bonding_driver%20()%0A%7B%0A%20%20%20%20local%20fn%3D%22install_bonding_driver%22%0A%0A%20%20%20%20if%20!%20bond_master_exists%20%24%7B1%7D%3B%20then%0A%20%20%20%20%20%20%20%20modprobe%20bonding%20%7C%7C%20return%201%0A%20%20%20%20%20%20%20%20echo%20%22%2B%241%22%20%3E%20%2Fsys%2Fclass%2Fnet%2Fbonding_masters%202%3E%2Fdev%2Fnull%0A%20%20%20%20fi%0A%20%20%20%20(%0A%20%20%20%20%20%20%20%20%23%20Set%20config%20here%0A%20%20%20%20%20%20%20%20need_config%20%22%241%22%0A%20%20%20%20%20%20%20%20source_config%0A%20%20%20%20%20%20%20%20if%20%5B%20-f%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2Fslaves%20%5D%20%26%26%20%5B%20%24(wc%20-l%20%3C%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2Fslaves)%20-eq%200%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%2Fsbin%2Fip%20link%20set%20dev%20%24%7BDEVICE%7D%20down%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20parse%20options%20and%20put%20them%20to%20arrays%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20arg%20in%20%24BONDING_OPTS%20%3B%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bopts_keys%5B%24%7B%23bopts_keys%5B*%5D%7D%5D%3D%24%7Barg%25%25%3D*%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bopts_vals%5B%24%7B%23bopts_vals%5B*%5D%7D%5D%3D%24%7Barg%23%23*%3D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20done%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20add%20the%20bits%20to%20setup%20driver%20parameters%20here%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20first%20set%20mode%2C%20miimon%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20((%20idx%3D0%3B%20idx%20%3C%20%24%7B%23bopts_keys%5B*%5D%7D%3B%20idx%2B%2B%20))%20%3B%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key%3D%24%7Bbopts_keys%5B%24idx%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3D%24%7Bbopts_vals%5B%24idx%5D%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Bkey%7D%22%20%3D%20%22mode%22%20%5D%20%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%24%7Bvalue%7D%22%20%3E%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2F%24key%20%7C%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20net_log%20%24%22Failed%20to%20set%20value%20'%24value'%20%5Bmode%5D%20to%20%24%7BDEVICE%7D%20bonding%20device%22%20err%20%24fn%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bopts_keys%5B%24idx%5D%3D%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Bkey%7D%22%20%3D%20%22miimon%22%20%5D%20%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%24%7Bvalue%7D%22%20%3E%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2F%24key%20%7C%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20net_log%20%24%22Failed%20to%20set%20value%20'%24value'%20%5Bmiimon%5D%20to%20%24%7BDEVICE%7D%20bonding%20device%22%20err%20%24fn%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bopts_keys%5B%24idx%5D%3D%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20done%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20set%20all%20other%20remaining%20options%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20((%20idx%3D0%3B%20idx%20%3C%20%24%7B%23bopts_keys%5B*%5D%7D%3B%20idx%2B%2B%20))%20%3B%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20key%3D%24%7Bbopts_keys%5B%24idx%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3D%24%7Bbopts_vals%5B%24idx%5D%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20option%20already%20set%3B%20take%20next%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%5B%20-z%20%22%24key%22%20%5D%5D%20%26%26%20continue%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Bkey%7D%22%20%3D%20%22arp_ip_target%22%20-a%20%22%24%7Bvalue%3A0%3A1%7D%22%20!%3D%20%22%2B%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20OLDIFS%3D%24IFS%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20IFS%3D'%2C'%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20arp_ip%20in%20%24value%3B%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20!%20grep%20-q%20%24arp_ip%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2F%24key%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%2B%24arp_ip%20%3E%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2F%24key%20%7C%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20net_log%20%24%22Failed%20to%20set%20'%24arp_ip'%20value%20%5Barp_ip_target%5D%20to%20%24%7BDEVICE%7D%20bonding%20device%22%20err%20%24fn%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20done%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20IFS%3D%24OLDIFS%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20elif%20%5B%20%22%24%7Bkey%7D%22%20%3D%20%22arp_ip_target%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20!%20grep%20-q%20%24%7Bvalue%23%2B%7D%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2F%24key%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%24value%22%20%3E%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2F%24key%20%7C%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20net_log%20%24%22Failed%20to%20set%20'%24value'%20value%20%5Barp_ip_target%5D%20to%20%24%7BDEVICE%7D%20bonding%20device%22%20err%20%24fn%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20elif%20%5B%20%22%24%7Bkey%7D%22%20!%3D%20%22primary%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%24value%20%3E%20%2Fsys%2Fclass%2Fnet%2F%24%7BDEVICE%7D%2Fbonding%2F%24key%20%7C%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20net_log%20%24%22Failed%20to%20set%20'%24value'%20value%20%5B%24key%5D%20to%20%24%7BDEVICE%7D%20bonding%20device%22%20err%20%24fn%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20done%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20)%0A%20%20%20%20return%200%0A%7D%0A%0Ais_bonding_device%20()%0A%7B%0A%20%20%20%20%5B%20-f%20%22%2Fsys%2Fclass%2Fnet%2F%241%2Fbonding%2Fslaves%22%20%5D%0A%7D%0A%0A%23%20Invoke%20this%20when%20%2Fetc%2Fresolv.conf%20has%20changed%3A%0Achange_resolv_conf%20()%0A%7B%0A%20%20%20%20s%3D%24(%2Fbin%2Fgrep%20'%5E%5B%5C%20%5C%20%20%20%20%20%20%20%5D*option'%20%2Fetc%2Fresolv.conf%202%3E%2Fdev%2Fnull)%0A%20%20%20%20if%20%5B%20%24%23%20-gt%201%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20if%20%5B%20%22x%24s%22%20!%3D%20%22x%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20s%3D%22%24s%22%24'%5Cn'%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20n_args%3D%24%23%0A%20%20%20%20%20%20%20%20while%20%5B%20%24n_args%20-gt%200%20%5D%3B%20do%20%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20%22%24s%22%20in%0A%20%20%20%20%20%20%20%20%20%20%20%20*%241*)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20shift%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20n_args%3D%24((%24n_args-1))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20esac%0A%20%20%20%20%20%20%20%20%20%20%20%20s%3D%22%24s%241%22%0A%20%20%20%20%20%20%20%20%20%20%20%20shift%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20%24%23%20-gt%200%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s%3D%22%24s%22%24'%5Cn'%0A%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20n_args%3D%24((%24n_args-1))%0A%20%20%20%20%20%20%20%20done%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20elif%20%5B%20%24%23%20-eq%201%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20if%20%5B%20%22x%24s%22%20!%3D%20%22x%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20s%3D%22%24s%22%24'%5Cn'%24(%2Fbin%2Fgrep%20-vF%20%22%24s%22%20%241)%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20s%3D%24(cat%20%241)%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%20%20%20%20(echo%20%22%24s%22%20%3E%20%2Fetc%2Fresolv.conf)%20%3E%2Fdev%2Fnull%202%3E%261%3B%0A%20%20%20%20r%3D%24%3F%0A%20%20%20%20if%20%5B%20%24r%20-eq%200%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%5B%20-x%20%2Fsbin%2Frestorecon%20%5D%20%26%26%20%2Fsbin%2Frestorecon%20%2Fetc%2Fresolv.conf%20%3E%2Fdev%2Fnull%202%3E%261%20%23%20reset%20the%20correct%20context%0A%20%20%20%20%20%20%20%20%2Fusr%2Fbin%2Flogger%20-p%20local7.notice%20-t%20%22NET%22%20-i%20%22%240%20%3A%20updated%20%2Fetc%2Fresolv.conf%22%0A%20%20%20%20%20%20%20%20%5B%20-e%20%2Fvar%2Frun%2Fnscd%2Fsocket%20%5D%20%26%26%20%2Fusr%2Fsbin%2Fnscd%20-i%20hosts%20%23%20invalidate%20cache%0A%20%20%20%20fi%0A%20%20%20%20return%20%24r%0A%7D%0A%0A%23%20Logging%20function%0A%23%0A%23%20Usage%3A%20net_log%20%3Cmessage%3E%20%3Cerr%7Cwarning%7Cinfo%3E%20%3Coptional%20file%2Ffunction%20name%3E%0A%23%0A%23%20Default%20level%20is%20'err'.%0A%0Anet_log()%0A%7B%0A%20%20%20%20local%20message%3D%22%241%22%0A%20%20%20%20local%20level%3D%22%242%22%0A%20%20%20%20local%20name%3D%22%243%22%0A%0A%20%20%20%20%5B%20-z%20%22%24message%22%20%5D%20%26%26%20return%201%0A%20%20%20%20%5B%20-z%20%22%24level%22%20%5D%20%26%26%20level%3Derr%0A%20%20%20%20%5B%20-z%20%22%24name%22%20%5D%20%26%26%20name%3D%240%0A%0A%20%20%20%20case%20%24level%20in%0A%20%20%20%20'debug')%0A%20%20%20%20%20%20%20%20local%20txt_level%3D%24%22DEBUG%20%20%20%20%20%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20'err')%0A%20%20%20%20%20%20%20%20local%20txt_level%3D%24%22ERROR%20%20%20%20%20%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20'warning')%0A%20%20%20%20%20%20%20%20local%20txt_level%3D%24%22WARN%20%20%20%20%20%20%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20'info')%0A%20%20%20%20%20%20%20%20local%20txt_level%3D%24%22INFO%20%20%20%20%20%20%22%0A%20%20%20%20%20%20%20%20%3B%3B%0A%20%20%20%20esac%0A%0A%20%20%20%20echo%20%22%24txt_level%3A%20%5B%24name%5D%20%24message%22%0A%0A%20%20%20%20if%20%5B%20-x%20%2Fusr%2Fbin%2Flogger%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%2Fusr%2Fbin%2Flogger%20-p%20daemon.%24level%20-t%20%22%24name%22%20%22%24message%22%0A%20%20%20%20fi%0A%20%20%20%20return%200%0A%7D%0A%0Aupdate_DNS_entries()%0A%7B%0A%20%20%20%20%23%20Remove%20duplicate%20values%20from%20DNS%20options%20if%20any%3A%0A%20%20%20%20if%20%5B%20-n%20%22%24%7BDNS3%7D%22%20%5D%20%26%26%20%5B%5B%20%22%24%7BDNS3%7D%22%20%3D%3D%20%22%24%7BDNS2%7D%22%20%7C%7C%20%22%24%7BDNS3%7D%22%20%3D%3D%20%22%24%7BDNS1%7D%22%20%5D%5D%3B%20then%0A%20%20%20%20%20%20%20%20unset%20DNS3%0A%20%20%20%20fi%0A%0A%20%20%20%20if%20%5B%20-n%20%22%24%7BDNS2%7D%22%20%5D%20%26%26%20%5B%5B%20%22%24%7BDNS2%7D%22%20%3D%3D%20%22%24%7BDNS1%7D%22%20%5D%5D%3B%20then%0A%20%20%20%20%20%20%20%20unset%20DNS2%0A%20%20%20%20fi%0A%0A%20%20%20%20%23%20Shift%20the%20DNS%20options%20if%20necessary%3A%0A%20%20%20%20if%20%5B%20-z%20%22%24%7BDNS1%7D%22%20%5D%20%26%26%20%5B%20-n%20%22%24%7BDNS2%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20DNS1%3D%22%24%7BDNS2%7D%22%0A%20%20%20%20%20%20%20%20unset%20DNS2%0A%20%20%20%20fi%0A%0A%20%20%20%20if%20%5B%20-z%20%22%24%7BDNS2%7D%22%20%5D%20%26%26%20%5B%20-n%20%22%24%7BDNS3%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20DNS2%3D%22%24%7BDNS3%7D%22%0A%20%20%20%20%20%20%20%20unset%20DNS3%0A%20%20%20%20fi%0A%0A%20%20%20%20%23%20We%20need%20to%20check%20DNS1%20again%20in%20case%20only%20DNS3%20was%20set%20at%20all%3A%0A%20%20%20%20if%20%5B%20-z%20%22%24%7BDNS1%7D%22%20%5D%20%26%26%20%5B%20-n%20%22%24%7BDNS2%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20DNS1%3D%22%24%7BDNS2%7D%22%0A%20%20%20%20%20%20%20%20unset%20DNS2%0A%20%20%20%20fi%0A%7D

