---
apiVersion: contrail.juniper.net/v1alpha1
kind: Manager
metadata:
  name: cluster1
  namespace: contrail
spec:
  commonConfiguration:
    hostNetwork: true
    replicas: 1
  keystoneSecretInstance : cluster1-admin-password
  services:
    cassandras:
    - metadata:
        labels:
          contrail_cluster: cluster1
        name: cassandra1
      spec:
        commonConfiguration:
          create: true
          nodeSelector:
            node-role.kubernetes.io/master: ""
        serviceConfiguration:
          containers:
            - name: cassandra
              image: registry:5000/cassandra:3.11.4
            - name: init
              image: registry:5000/python:alpine
            - name: init2
              image: registry:5000/cassandra:3.11.4
    config:
      metadata:
        labels:
          contrail_cluster: cluster1
        name: config1
      spec:
        commonConfiguration:
          create: true
          nodeSelector:
            node-role.kubernetes.io/master: ""
        serviceConfiguration:
          cassandraInstance: cassandra1
          keystoneInstance: keystone
          containers:
          - name: analyticsapi
            image: registry:5000/contrail-analytics-api:master.1175
          - name: api
            image: registry:5000/contrail-controller-config-api:master.1175
          - name: collector
            image: registry:5000/contrail-analytics-collector:master.1175
          - name: devicemanager
            image: registry:5000/contrail-controller-config-devicemgr:master.1175
          - name: dnsmasq
            image: registry:5000/contrail-controller-config-dnsmasq:master.1175
          - name: init
            image: registry:5000/python:alpine
          - name: init2
            image: registry:5000/busybox
          - name: nodeinit
            image: registry:5000/contrail-node-init:master.1175
          - name: redis
            image: registry:5000/redis:4.0.2
          - name: schematransformer
            image: registry:5000/contrail-controller-config-schema:master.1175
          - name: servicemonitor
            image: registry:5000/contrail-controller-config-svcmonitor:master.1175
          - name: queryengine
            image: registry:5000/contrail-analytics-query-engine:master.1175
          - name: statusmonitor
            image: registry:5000/contrail-statusmonitor:change_image_format.aa5218b
          logLevel: SYS_DEBUG
          zookeeperInstance: zookeeper1
          authMode: keystone
    controls:
    - metadata:
        labels:
          contrail_cluster: cluster1
          control_role: master
        name: control1
      spec:
        commonConfiguration:
          create: true
          nodeSelector:
            node-role.kubernetes.io/master: ""
        serviceConfiguration:
          cassandraInstance: cassandra1
          containers:
          - name: control
            image: registry:5000/contrail-controller-control-control:master.1175
          - name: dns
            image: registry:5000/contrail-controller-control-dns:master.1175
          - name: init
            image: registry:5000/python:alpine
          - name: named
            image: registry:5000/contrail-controller-control-named:master.1175
          - name: nodeinit
            image: registry:5000/contrail-node-init:master.1175
          - name: statusmonitor
            image: registry:5000/contrail-statusmonitor:change_image_format.aa5218b
          zookeeperInstance: zookeeper1
    provisionManager:
      metadata:
        labels:
          contrail_cluster: cluster1
        name: provmanager1
      spec:
        commonConfiguration:
          create: true
          nodeSelector:
            node-role.kubernetes.io/master: ""
          replicas: 1
        serviceConfiguration:
          keystoneInstance: keystone
          containers:
          - name: init
            image: registry:5000/python:alpine
          - name: provisioner
            image: registry:5000/contrail-provisioner:change_image_format.aa5218b
    rabbitmq:
      metadata:
        labels:
          contrail_cluster: cluster1
        name: rabbitmq1
      spec:
        commonConfiguration:
          create: true
          nodeSelector:
            node-role.kubernetes.io/master: ""
        serviceConfiguration:
          containers:
          - name: init
            image: registry:5000/python:alpine
          - name: rabbitmq
            image: registry:5000/rabbitmq:3.7
    webui:
      metadata:
        labels:
          contrail_cluster: cluster1
        name: webui1
      spec:
        commonConfiguration:
          create: true
          nodeSelector:
            node-role.kubernetes.io/master: ""
        serviceConfiguration:
          cassandraInstance: cassandra1
          keystoneInstance: keystone
          containers:
          - name: init
            image: registry:5000/python:alpine
          - name: nodeinit
            image: registry:5000/contrail-node-init:master.1175
          - name: redis
            image: registry:5000/redis:4.0.2
          - name: webuijob
            image: registry:5000/contrail-controller-webui-job:master.1175
          - name: webuiweb
            image: registry:5000/contrail-controller-webui-web:master.1175
    zookeepers:
    - metadata:
        labels:
          contrail_cluster: cluster1
        name: zookeeper1
      spec:
        commonConfiguration:
          create: true
          nodeSelector:
            node-role.kubernetes.io/master: ""
        serviceConfiguration:
          containers:
          - name: init
            image: registry:5000/python:alpine
          - name: zookeeper
            image: registry:5000/zookeeper:3.5.5
    command:
      metadata:
        name: command
      spec:
        commonConfiguration:
          activate: true
          create: true
          hostNetwork: true
          tolerations:
            - effect: NoSchedule
              operator: Exists
            - effect: NoExecute
              operator: Exists
          nodeSelector:
            node-role.kubernetes.io/master: ""
        serviceConfiguration:
          configAPIURL: https://kind-control-plane:8082
          telemetryURL: https://kind-control-plane:8081
          postgresInstance: postgres
          swiftInstance: swift
          swiftProxyPort: 5080
          keystonePort: 5555
          keystoneInstance: keystone
          containers:
          - name: api
            image: registry:5000/contrail-command:master.1175
          - name: init
            image: registry:5000/contrail-command:master.1175
          - name: wait-for-ready-conf
            image: registry:5000/busybox
    keystone:
      metadata:
        name: keystone
      spec:
        commonConfiguration:
          activate: true
          create: true
          hostNetwork: true
          tolerations:
            - effect: NoSchedule
              operator: Exists
            - effect: NoExecute
              operator: Exists
          nodeSelector:
            node-role.kubernetes.io/master: ""
        serviceConfiguration:
          memcachedInstance: "memcached"
          postgresInstance: postgres
          listenPort: 5555
          containers:
          - name: wait-for-ready-conf
            image: registry:5000/busybox
          - name: keystoneDbInit
            image: registry:5000/postgresql-client
          - name: keystoneInit
            image: registry:5000/centos-binary-keystone:train
          - name: keystone
            image: registry:5000/centos-binary-keystone:train
          - name: keystoneSsh
            image: registry:5000/centos-binary-keystone-ssh:train
          - name: keystoneFernet
            image: registry:5000/centos-binary-keystone-fernet:train
    postgres:
      metadata:
        name: postgres
      spec:
        containers:
        - name: postgres
          image: registry:5000/postgres
        - name: wait-for-ready-conf
          image: registry:5000/busybox
    memcached:
      metadata:
        name: memcached
        namespace: contrail
      spec:
        serviceConfiguration:
          containers:
          - name: memcached
            image: "registry:5000/centos-binary-memcached:train"
    swift:
      metadata:
        name: swift
      spec:
        serviceConfiguration:
          credentialsSecretName: "swift-credentials-secret"
          containers:
          - name: ring-reconciler
            image: registry:5000/centos-source-swift-base:train
          swiftProxyConfiguration:
            memcachedInstance: "memcached"
            keystoneInstance: "keystone"
            listenPort: 5080
            containers:
            - name: init
              image: registry:5000/centos-binary-kolla-toolbox:train
            - name: wait-for-ready-conf
              image: registry:5000/busybox
            - name: api
              image: registry:5000/centos-binary-swift-proxy-server:train
          swiftStorageConfiguration:
            accountBindPort: 6001
            containerBindPort: 6002
            objectBindPort: 6000
            device: d1
            containers:
            - name: swiftObjectExpirer
              image: registry:5000/centos-binary-swift-object-expirer:train
            - name: swiftObjectUpdater
              image: registry:5000/centos-binary-swift-object:train
            - name: swiftObjectReplicator
              image: registry:5000/centos-binary-swift-object:train
            - name: swiftObjectAuditor
              image: registry:5000/centos-binary-swift-object:train
            - name: swiftObjectServer
              image: registry:5000/centos-binary-swift-object:train
            - name: swiftContainerUpdater
              image: registry:5000/centos-binary-swift-container:train
            - name: swiftContainerReplicator
              image: registry:5000/centos-binary-swift-container:train
            - name: swiftContainerAuditor
              image: registry:5000/centos-binary-swift-container:train
            - name: swiftContainerServer
              image: registry:5000/centos-binary-swift-container:train
            - name: swiftAccountReaper
              image: registry:5000/centos-binary-swift-account:train
            - name: swiftAccountReplicator
              image: registry:5000/centos-binary-swift-account:train
            - name: swiftAccountAuditor
              image: registry:5000/centos-binary-swift-account:train
            - name: swiftAccountServer
              image: registry:5000/centos-binary-swift-account:train
